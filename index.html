<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>March Madness 2025 - Submit Your Bracket</title>
  <!-- jQuery and jquery-bracket CSS/JS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-bracket@0.11.1/dist/jquery.bracket.min.css"/>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-bracket@0.11.1/dist/jquery.bracket.min.js"></script>
  <!-- Firebase Compat Scripts (for namespaced API) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    /* ========= BASIC STYLES ========= */
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #003087, #ffffff);
      margin: 0;
      padding: 20px;
      color: #333;
    }
    header {
      text-align: center;
      padding: 20px;
      background: rgba(255,255,255,0.9);
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #003087;
      margin: 0;
      font-size: 2.5em;
    }
    main {
      max-width: 1200px;
      margin: 20px auto;
    }
    /* ========= FORM ========= */
    form {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    input, button {
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      min-width: 200px;
      transition: all 0.3s;
    }
    input {
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      background: #003087;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #00205b;
    }
    /* ========= BRACKET LAYOUT ========= */
    .bracket-wrapper {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      overflow-x: auto;
      margin: 20px 0;
    }
    /* Left and Right “halves” */
    .side {
      flex: 1;
      min-width: 300px;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    /* Each side gets its own header block (the numbers/points for each new round) */
    .round-header {
      text-align: center;
      font-size: 0.7em;
      font-weight: bold;
      margin-bottom: 4px;
      border-bottom: 1px dotted #003087;
      padding-bottom: 2px;
    }
    /* Container for the jQuery bracket plugin instance */
    .bracket-half {
      min-height: 400px;
    }
    /* Center column for the Championship matchup */
    .center-finals {
      flex: 0 0 250px;
      text-align: center;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .center-label {
      font-size: 0.7em;
      margin-bottom: 5px;
      font-weight: bold;
      color: #003087;
    }
    #championship-matchup {
      margin-bottom: 5px;
    }
    #championship-matchup span {
      display: inline-block;
      padding: 5px 10px;
      margin: 0 5px;
      background: #fff;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #championship-matchup span.winner {
      background: #003087;
      color: white;
    }
    /* Champion box below championship */
    #champion-box {
      margin-top: 5px;
      padding: 5px;
      background: #fff;
      border-radius: 5px;
      min-height: 30px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      font-weight: bold;
      color: #003087;
    }
    /* ========= MODAL (for game selection) ========= */
    #modal {
      display: none;
      position: fixed;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
    }
    #modal-content {
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    #modal-content button {
      margin: 10px;
    }
    @media (max-width: 800px) {
      form { flex-direction: column; }
      input, button { width: 100%; }
      .bracket-wrapper { flex-direction: column; }
    }
  </style>
</head>
<body>
  <header>
    <h1>March Madness 2025</h1>
  </header>
  <main>
    <!-- User Submission Form -->
    <form id="userForm">
      <input type="text" id="name" placeholder="Your Name" required />
      <input type="email" id="email" placeholder="Your Email" required />
      <input type="text" id="bracketName" placeholder="Bracket Name" required />
      <input type="number" id="tiebreaker" placeholder="Championship Game Score (Tiebreaker)" required />
      <button type="submit">Submit Bracket</button>
    </form>
    
    <!-- Bracket Display -->
    <div class="bracket-wrapper">
      <!-- Left Side -->
      <div class="side">
        <div id="left-bracket" class="bracket-half"></div>
      </div>
      
      <!-- Center: Championship matchup -->
      <div class="center-finals">
        <div class="center-label">Championship - 10 pts</div>
        <div id="championship-matchup"></div>
        <div class="center-label">Champion - 20 pts</div>
        <div id="champion-box"></div>
      </div>
      
      <!-- Right Side -->
      <div class="side">
        <div id="right-bracket" class="bracket-half"></div>
      </div>
    </div>
    
    <!-- Modal for match selection -->
    <div id="modal">
      <div id="modal-content">
        <h3>Pick the Winner</h3>
        <button id="option1"></button>
        <button id="option2"></button>
      </div>
    </div>
  </main>
  
  <script>
    /****** Firebase Setup ******/
    // Replace with your own Firebase configuration:
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "marchmadness2025.firebaseapp.com",
      projectId: "marchmadness2025",
      storageBucket: "marchmadness2025.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    /****** Build Tournament Data ******/
    // Generate 64 teams (Team 1 to Team 64) grouped into 32 pairs.
    const teams = [];
    for (let i = 1; i <= 64; i += 2) {
      teams.push([ "Team " + i, "Team " + (i + 1) ]);
    }
    // Split into two halves (each half has 16 pairs = 32 teams)
    const leftTeams = teams.slice(0, 16);
    const rightTeams = teams.slice(16, 32);
    let champion = null;
  
    /****** Modal for Match Selection ******/
    let modalMatchData = null;
    function showWinnerModal(matchData) {
      modalMatchData = matchData;
      $("#option1").text(matchData.teams[0]);
      $("#option2").text(matchData.teams[1]);
      $("#modal").fadeIn(200);
    }
    $("#option1").click(function() {
      if (modalMatchData) {
        modalMatchData.setWinner(modalMatchData.teams[0]);
        $("#modal").fadeOut(200);
        updateFinals();  
      }
    });
    $("#option2").click(function() {
      if (modalMatchData) {
        modalMatchData.setWinner(modalMatchData.teams[1]);
        $("#modal").fadeOut(200);
        updateFinals();  
      }
    });
  
    /****** Initialize the Brackets for Each Side ******/
    $(document).ready(function() {
      console.log("jQuery ready");
      // Initialize left side bracket (32 teams from 16 pairs)
      $("#left-bracket").bracket({
        init: { teams: leftTeams, results: null },
        dir: 'lr',
        onMatchClick: function(data) {
          showWinnerModal(data);
        }
      });
      // Initialize right side bracket similarly
      $("#right-bracket").bracket({
        init: { teams: rightTeams, results: null },
        dir: 'rl',
        onMatchClick: function(data) {
          showWinnerModal(data);
        }
      });
      console.log("Brackets initialized");
      
      // Give the brackets a brief moment to render, then inject round headers.
      setTimeout(injectRoundHeaders, 500);
    });
  
    /****** Inject Round Headers into Bracket Rounds ******/
    function injectRoundHeaders() {
      // We expect the plugin to create round containers with class "jqbracket-round"
      // For a 32-team bracket, there should be 5 rounds (round indices 0 to 4).
      const leftHeaderLabels = [
        "Round of 32 (1pt)",
        "Sweet 16 (3pt)",
        "Elite 8 (5pt)",
        "Final Four (10pt)",
        ""  // For the final game of this half, no header is needed.
      ];
      $("#left-bracket .jqbracket-round").each(function(index) {
        if (leftHeaderLabels[index]) {
          $(this).prepend('<div class="round-header">' + leftHeaderLabels[index] + '</div>');
        }
      });
      const rightHeaderLabels = [
        "Round of 32 (1pt)",
        "Sweet 16 (3pt)",
        "Elite 8 (5pt)",
        "Final Four (10pt)",
        ""  // For the final game; header not displayed.
      ];
      $("#right-bracket .jqbracket-round").each(function(index) {
        if (rightHeaderLabels[index]) {
          $(this).prepend('<div class="round-header">' + rightHeaderLabels[index] + '</div>');
        }
      });
    }
  
    /****** Update Championship Matchup ******/
    function updateFinals() {
      // Retrieve bracket data from each side.
      const leftData = $("#left-bracket").data("bracket").getData();
      const rightData = $("#right-bracket").data("bracket").getData();
      // For a 32-team bracket, the final game (winner of round 5) is at index 4.
      const leftWinner = leftData.results && leftData.results[0] && leftData.results[0][4] && leftData.results[0][4][0] ? leftData.results[0][4][0].player : null;
      const rightWinner = rightData.results && rightData.results[0] && rightData.results[0][4] && rightData.results[0][4][0] ? rightData.results[0][4][0].player : null;
      
      if (leftWinner && rightWinner) {
        $("#championship-matchup").html(`
          <span class="final-option" onclick="selectChampion('${leftWinner}')">${leftWinner}</span>
          <span class="final-option" onclick="selectChampion('${rightWinner}')">${rightWinner}</span>
        `);
      }
    }
    
    function selectChampion(team) {
      champion = team;
      $("#championship-matchup .final-option").removeClass("winner");
      $("#championship-matchup .final-option").each(function(){
        if ($(this).text() === team) $(this).addClass("winner");
      });
      $("#champion-box").text(team);
      console.log("Champion selected:", champion);
    }
  
    /****** Form Submission with Validation & Firestore Write ******/
    document.getElementById("userForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const bracketName = document.getElementById("bracketName").value.trim();
      const tiebreaker = document.getElementById("tiebreaker").value.trim();
      const leftBracketData = $("#left-bracket").data("bracket").getData();
      const rightBracketData = $("#right-bracket").data("bracket").getData();
      
      if (!champion) {
        alert("Please complete your bracket by selecting an overall champion.");
        return;
      }
      
      const submission = {
        name,
        email,
        bracketName,
        tiebreaker: Number(tiebreaker),
        leftBracket: leftBracketData,
        rightBracket: rightBracketData,
        champion,
        submittedAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      try {
        const docRef = await db.collection("brackets").add(submission);
        console.log("Bracket submission saved with ID: ", docRef.id);
        alert("Bracket submitted successfully!");
        // Optionally, reset the form and bracket UI.
      } catch (error) {
        console.error("Error writing document: ", error);
        alert("There was an error submitting your bracket. Please try again.");
      }
    });
  </script>
</body>
</html>
